# HTTP 공부하기 02

<br>
<br>
<br>

## HTTP 상태코드

http 상태코드는 클라이언트가 보낸 요청의 처리상태를 응답에서 알려주는 기능이다.
크게 100,200,300,400,500대 로 나뉘어져 구분되어 있다.

<br>

* 1xx (Informational): 요청이 수신되어 처리중
* 2xx (Successful): 요청이 정상적으로 처리 됨
* 3xx (Redirection): 요청을 완료하려면 클라이언트 측에서 추가 행동이 필요하다는 의미인데 리다이렉션을 의미하는 경우도 많다. (HTTP Response 메세지에 Header Field에 Location 값이 있으면 리다이렉션 됨)
* 4xx (Client Error): 클라이언트 측에서 오류 발생, 잘못된 문법등으로 서버가 요청을 수행할 수 없음
* 5xx (Server Error): 서버 측에서 오류 발생, 서버가 정상 요청을 처리하지 못함



### 자주 사용되는 상태코드

더 자세항 설명은 [여기](https://developer.mozilla.org/ko/docs/Web/HTTP/Status) 를 참고하자

| 상태코드 | 설명 |
| ------ | ----- |
| 200 | ok, 정상적으로 처리 되었다. |
| 201 | created, 새로운 리소스가 생성 되었음을 의미한다, 201인 경우 http 응답헤더에 location 이라는 값으로 생성된 리소스의 uri를 넣어주는 경우가 많다. |
| 202 | accepted, 요청이 접수되었으나 처리가 완료되지 않았다. 예를들어 batch가 돌아야 실제 처리가 완료되는 경우인데 잘 안쓰인다. |
| 204 | NoContent요청을 성공적으로 수행했지만 별도로 내려줄 컨텐츠가 없는경우, 예를들어 `임시저장 save 버튼`을 눌러 임시데이터를 저장했는데 딱히 보여줄 건 없는경우 이다. |
| 300 | Mutiple Choices, 요청에 대한 응답이 여러개 이다, 사용자 에이전트(브라우저)는 여러개의 응답중 하나를 반드시 선택해야 한다, 선택방식은 표준이 없음. |
| 301 | Moved Permanently, 기존 리소스의 uri가 영구적으로 변경되었음을 의미한다, 검색엔진 에서도 변경됨을 인지할 수 있음 |
| 302 | Found, 요청 리소스 URI가 일시적으로 변경 되었음을 의미한다. (요청메서드/메세지바디 대부분 GET 으로 처리 하지만 명확하지 않다.) |
| 303 | See Other(en-US), 요청 리소스 URI가 일시적으로 변경 되었음을 의미한다. (요청메서드/메세지바디 무조건 GET 으로 처리 한다.) |
| 304 | Not Modified, 캐시를 목적으로 사용 된다. (리소스가 바뀐게 없으니 캐시를 재사용 하라는 의미)  |
| 307 | Temporary Redirect, 302/303과 같은 기능을 하는데 처음 요청당시 요청메서드/요청바디가 POST라면 유지한채로 리다이렉션 한다. |
| 308 | Permanent Redirect, 301과 같은 기능이나 리다이렉트 할 때 처음 요청이 POST메서드 이면 메서드와 메세지바디를 유지하며 리다이렉트 시킨다. (실제로는 쓸일이 없다. 리소스가 변했어도 api 요청 스펙도 변하기 때문에) |
| 400 | Bad Request, 클라이언트 요청이 api 스펙과 안맞아 서버가 처리를 못한다는 의미다. |
| 401 | Unauthorized, 클라이언트가 해당 리소스에 대한 인증을 해야한다. (Authentication = 인증/로그인이 안됐다, Authorization = 인가/권한이 없다.) |
| 403 | Forbidden, 접근 권한이 불충분해 서버가 승인을 거부하는 경우 |
| 404 | Not Found, 해당 리소스가 없는데 서버에 요청을 한 경우 혹은 해당 리소스를 숨기고 싶은경우에도 사용된다. |
| 500 | Internal Server Error, 서버 내부 오류로 발생한 경우 (애매하면 다 상태코드로 처리 가능) |
| 503 | Service Unavailable, 서비스 이용불가, 서버가 일시적 과부하 또는 예정된 작업으로 인해 잠시 요청을 처리할 수 없는경우, `Retry-After` 헤더 필드를 통해 언제 복구되는지를 알려줄 수도 있다. |

<br>

#### PRG: `Post/Redirect/Get` 이란?

post로 주문서를 생성한 이후에 웹브라우저에서 실수로 새로고침을 누른다면 의도와 다르게 중복으로 요청이 생성될 것이다. 이런 경우를 막기위해 응답을 GET으로 바꿔
응답해주면 새로고침을 해도 중복되는 오류를 막을 수 있다. (어차피 서버에서 주문서id를 통해 막겠지만 클라이언트 차원에서 방지할 수 있다)

1. POST `/orders`로 주문서 생성을 요청
2. 요청 처리이후 DB에 새 주문서 생성
3. 응답을 `200 ok`가 아닌 `302 Found`로 주고 응답헤더 로케이션에 `/orders/order-result/19`를 추가한다.
4. 브라우저는 리다이렉션된 곳에서 `GET /order-result/19`를 처리할 것이고 새로고침 해도 생성이 아닌 주문결과를 조회해 전달하게 된다.

